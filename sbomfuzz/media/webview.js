const h=acquireVsCodeApi();let g=null;function C(t={}){g=t.onRustAnalysisDone||(()=>{}),onGlobalContext=t.onGlobalContext||(()=>{}),onFuzzTargetsListed=t.onFuzzTargetsListed||(()=>{}),window.addEventListener("message",n=>{const o=n.data;switch(o.command){case"globalContext":onGlobalContext&&onGlobalContext(o.context||{});break;case"rustAnalysisDone":a("Rust analysis completed successfully"),g&&g(o.results||[]);break;case"fuzzTargetsListed":onFuzzTargetsListed&&onFuzzTargetsListed(o.targets||[]);break;default:console.warn("Unhandled message from extension:",o);break}}),i({command:"getGlobaclContext"})}function i(t){h.postMessage(t)}function a(t){i({command:"log",message:t})}let c=null,p=null,b=null;const m=document.getElementById("entry-list"),v=document.getElementById("path-display-container");function r(t,n){var s;n.innerHTML="";const o=t.filter(e=>e.status!=="Ignore");t.filter(e=>e.status==="Ignore"),o.sort((e,f)=>f.priorityScore-e.priorityScore),t=[...o];for(const e of t){a(`status: ${e.status}`);const L=`<span class="status-badge" style="background:${{New:"gray",Ignore:"darkred",HarnessGenerated:"green"}[e.status]||"black"};">${e.status}</span>`,d=document.createElement("button");d.textContent="Ignore";const u=document.createElement("button");u.textContent="Generate Harness";const l=document.createElement("div");l.className="function-button",l.innerHTML=`
        <div style="font-weight:bold; margin-bottom:4px; display: flex; gap: 2px; flex-wrap: wrap; align-items: center;">
      <span>${e.functionModulePath}::${e.functionName}</span>
    ${L}
        </div>
        <div>${(s=e.functionLocation)==null?void 0:s.filePath.replace(c,"")}</div>
        <div>Priority Score: ${e.priorityScore.toFixed(3)}</div>
        <div class="btns-div" style="margin-top:6px;"></div>
      `;const z=l.getElementsByClassName("btns-div")[0];z.appendChild(d),z.appendChild(u),d.onclick=y=>{y.stopPropagation(),e.status="Ignore",a(`ignore, ${e.status}`),r(t,n)},u.onclick=y=>{a("generate"),i({command:"generateHarness",fuzzRoot:p,target:e}),e.status="HarnessGenerated",r(t,n)},l.onclick=()=>{i({command:"openLocation",filePath:e.functionLocation.filePath,offset:e.functionLocation.offset})},n.appendChild(l)}}function x(t){const n=t.nextElementSibling;t.classList.toggle("expanded")?n.style.display="block":n.style.display="none"}const E=document.querySelectorAll(".collapsible-header");E.forEach(t=>{a("Setting up collapsible header:",t.textContent),t.addEventListener("click",()=>{a("Collapsible header clicked:",t.textContent),x(t)})});C({onFuzzTargetsListed:t=>{a("ðŸ§ª Fuzz targets listed:");const n=document.getElementById("harness-list");if(n.innerHTML="",t.length===0){n.innerHTML="<div>No fuzz targets found.</div>";return}for(const o of t){const s=document.createElement("div");s.className="function-button",s.innerHTML=`
        <div style="font-weight:bold; margin-bottom:4px;">
          ${o.name}
        </div>
        <div>
          ${o.path.replace(p,"")}
        </div>
      `,s.onclick=()=>{i({command:"openLocation",filePath:o.path,offset:0})},n.appendChild(s)}},onRustAnalysisDone:t=>{a("Rendering function results"),m.innerHTML="",r(t,m)},onGlobalContext:t=>{a("Global context received:",t.projectRoot);const n=t.projectRoot;n?(a("ðŸ“¦ Got Cargo project root: "+n),c=n,v.innerHTML=`Cargo Project Root: ${n}`):v.innerHTML="No Cargo project found.";const o=document.getElementById("fuzz-path-display"),s=t.fuzzRoot;if(s)a("ðŸ§ª Got Fuzz root: "+s),p=s,o.innerHTML=`Fuzz Root: ${s}`,a("Getting Fuzz targets: "),i({command:"getFuzzTargets",fuzzRoot:s});else{o.innerText="No Fuzz root found.";const e=document.createElement("button");e.textContent="Create a Root",e.addEventListener("click",()=>{i({command:"createFuzzRoot",target:c})}),o.appendChild(e)}t.results&&t.results.length>0&&(b=t.results,r(b,m))}});document.getElementById("start-analyzer").addEventListener("click",()=>{i({command:"runAnalyzer",target:"none",projectPath:c})});document.getElementById("test-vis").addEventListener("click",()=>{i({command:"testVisualization"})});
