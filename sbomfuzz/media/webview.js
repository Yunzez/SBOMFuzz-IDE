const C=acquireVsCodeApi();let p=null;function h(t={}){p=t.onRustAnalysisDone||(()=>{}),onGlobalContext=t.onGlobalContext||(()=>{}),onFuzzTargetsListed=t.onFuzzTargetsListed||(()=>{}),window.addEventListener("message",o=>{const n=o.data;switch(n.command){case"globalContext":onGlobalContext&&onGlobalContext(n.context||{});break;case"rustAnalysisDone":a("Rust analysis completed successfully"),p&&p(n.results||[]);break;case"fuzzTargetsListed":onFuzzTargetsListed&&onFuzzTargetsListed(n.targets||[]);break;case"refreshHarnessList":onFuzzTargetsListed&&onFuzzTargetsListed(n.targets||[]);default:console.warn("Unhandled message from extension:",n);break}}),i({command:"getGlobaclContext"})}function i(t){C.postMessage(t)}function a(t){i({command:"log",message:t})}let c=null,z=null,y=null;const f=document.getElementById("entry-list"),L=document.getElementById("path-display-container");function r(t,o){var s;o.innerHTML="";const n=t.filter(e=>e.status!=="Ignore");t.filter(e=>e.status==="Ignore"),n.sort((e,d)=>d.priorityScore-e.priorityScore),t=[...n];for(const e of t){a(`status: ${e.status}`);const u=`<span class="status-badge" style="background:${{New:"gray",Ignore:"darkred",HarnessGenerated:"green"}[e.status]||"black"};">${e.status}</span>`,g=document.createElement("button");g.textContent="Ignore";const m=document.createElement("button");m.textContent="Generate Harness";const l=document.createElement("div");l.className="function-button",l.innerHTML=`
        <div style="font-weight:bold; margin-bottom:4px; display: flex; gap: 2px; flex-wrap: wrap; align-items: center;">
      <span>${e.functionModulePath}::${e.functionName}</span>
    ${u}
        </div>
        <div>${(s=e.functionLocation)==null?void 0:s.filePath.replace(c,"")}</div>
        <div>Priority Score: ${e.priorityScore.toFixed(3)}</div>
        <div class="btns-div" style="margin-top:6px;"></div>
      `;const b=l.getElementsByClassName("btns-div")[0];b.appendChild(g),b.appendChild(m),g.onclick=v=>{v.stopPropagation(),e.status="Ignore",a(`ignore, ${e.status}`),r(t,o)},m.onclick=v=>{a("generate"),i({command:"generateHarness",fuzzRoot:z,target:e}),e.status="HarnessGenerated",r(t,o)},l.onclick=()=>{i({command:"openLocation",filePath:e.functionLocation.filePath,offset:e.functionLocation.offset})},o.appendChild(l)}}function x(t){const o=t.nextElementSibling;t.classList.toggle("expanded")?o.style.display="block":o.style.display="none"}const E=document.querySelectorAll(".collapsible-header");E.forEach(t=>{a("Setting up collapsible header:",t.textContent),t.addEventListener("click",()=>{a("Collapsible header clicked:",t.textContent),x(t)})});h({onFuzzTargetsListed:t=>{a("ðŸ§ª Fuzz targets listed:");const o=document.getElementById("harness-list");if(o.innerHTML="",t.length===0){o.innerHTML="<div>No fuzz targets found.</div>";return}for(const n of t){const s=document.createElement("div"),e=document.createElement("button");e.textContent="Run",s.className="function-button",s.innerHTML=`
        <div style="font-weight:bold; margin-bottom:4px;">
          ${n.name}
        </div>
        <div>
          ${n.path.replace(z,"")}
        </div>
          <div class="btns-div" style="margin-top:6px;"></div>
      `,s.onclick=()=>{i({command:"openLocation",filePath:n.path,offset:0})},s.getElementsByClassName("btns-div")[0].appendChild(e),e.onclick=u=>{u.stopPropagation(),a(`Running fuzz target: ${n.name}`),i({command:"runFuzzTarget",target:n.name})},o.appendChild(s)}},onRustAnalysisDone:t=>{a("Rendering function results"),f.innerHTML="",r(t,f)},onGlobalContext:t=>{a("Global context received:",t.projectRoot);const o=t.projectRoot;o?(a("ðŸ“¦ Got Cargo project root: "+o),c=o,L.innerHTML=`Cargo Project Root: ${o}`):L.innerHTML="No Cargo project found.";const n=document.getElementById("fuzz-path-display"),s=t.fuzzRoot;if(s)a("ðŸ§ª Got Fuzz root: "+s),z=s,n.innerHTML=`Fuzz Root: ${s}`,a("Getting Fuzz targets: "),i({command:"getFuzzTargets",fuzzRoot:s});else{n.innerText="No Fuzz root found.";const e=document.createElement("button");e.textContent="Create a Root",e.addEventListener("click",()=>{i({command:"createFuzzRoot",target:c})}),n.appendChild(e)}t.results&&t.results.length>0&&(y=t.results,r(y,f))}});document.getElementById("start-analyzer").addEventListener("click",()=>{i({command:"runAnalyzer",target:"none",projectPath:c})});document.getElementById("test-vis").addEventListener("click",()=>{i({command:"testVisualization"})});
