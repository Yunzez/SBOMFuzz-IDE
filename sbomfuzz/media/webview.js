const C=acquireVsCodeApi();let m=null;function x(t={}){m=t.onRustAnalysisDone||(()=>{}),onGlobalContext=t.onGlobalContext||(()=>{}),onFuzzTargetsListed=t.onFuzzTargetsListed||(()=>{}),window.addEventListener("message",n=>{const o=n.data;switch(o.command){case"globalContext":onGlobalContext&&onGlobalContext(o.context||{});break;case"rustAnalysisDone":a("Rust analysis completed successfully"),m&&m(o.results||[]);break;case"fuzzTargetsListed":onFuzzTargetsListed&&onFuzzTargetsListed(o.targets||[]);break;default:console.warn("Unhandled message from extension:",o);break}}),i({command:"getGlobaclContext"})}function i(t){C.postMessage(t)}function a(t){i({command:"log",message:t})}let r=null,f=null,v=null;const p=document.getElementById("entry-list"),L=document.getElementById("path-display-container");function d(t,n){var l;n.innerHTML="";const o=t.filter(e=>e.status!=="Ignore"),s=t.filter(e=>e.status==="Ignore");o.sort((e,z)=>z.priorityScore-e.priorityScore),t=[...o,...s];for(const e of t){a(`status: ${e.status}`);const h=`<span class="status-badge" style="background:${{New:"gray",Ignore:"darkred",HarnessGenerated:"green"}[e.status]||"black"};">${e.status}</span>`,u=document.createElement("button");u.textContent="Ignore";const g=document.createElement("button");g.textContent="Generate Harness";const c=document.createElement("div");c.className="function-button",c.innerHTML=`
        <div style="font-weight:bold; margin-bottom:4px; display: flex; gap: 2px; flex-wrap: wrap; align-items: center;">
      <span>${e.functionModulePath}::${e.functionName}</span>
    ${h}
        </div>
        <div>${(l=e.functionLocation)==null?void 0:l.filePath.replace(r,"")}</div>
        <div>Priority Score: ${e.priorityScore.toFixed(3)}</div>
        <div class="btns-div" style="margin-top:6px;"></div>
      `;const y=c.getElementsByClassName("btns-div")[0];y.appendChild(u),y.appendChild(g),u.onclick=b=>{b.stopPropagation(),e.status="Ignore",a(`ignore, ${e.status}`),d(t,n)},g.onclick=b=>{a("generate"),i({command:"generateHarness",fuzzRoot:f,target:e}),e.status="HarnessGenerated",d(t,n)},c.onclick=()=>{i({command:"openLocation",filePath:e.functionLocation.filePath,offset:e.functionLocation.offset})},n.appendChild(c)}}function E(t){const n=t.nextElementSibling;t.classList.toggle("expanded")?n.style.display="block":n.style.display="none"}const R=document.querySelectorAll(".collapsible-header");R.forEach(t=>{a("Setting up collapsible header:",t.textContent),t.addEventListener("click",()=>{a("Collapsible header clicked:",t.textContent),E(t)})});x({onFuzzTargetsListed:t=>{a("ðŸ§ª Fuzz targets listed:");const n=document.getElementById("harness-list");if(n.innerHTML="",t.length===0){n.innerHTML="<div>No fuzz targets found.</div>";return}for(const o of t){const s=document.createElement("div");s.className="function-button",s.innerHTML=`
        <div style="font-weight:bold; margin-bottom:4px;">
          ${o.name}
        </div>
        <div>
          ${o.path.replace(f,"")}
        </div>
      `,s.onclick=()=>{i({command:"openLocation",filePath:o.path,offset:0})},n.appendChild(s)}},onRustAnalysisDone:t=>{a("Rendering function results"),p.innerHTML="",d(t,p)},onGlobalContext:t=>{a("Global context received:",t.projectRoot);const n=t.projectRoot;n?(a("ðŸ“¦ Got Cargo project root: "+n),r=n,L.innerHTML=`Cargo Project Root: ${n}`):L.innerHTML="No Cargo project found.";const o=document.getElementById("fuzz-path-display"),s=t.fuzzRoot;if(s)a("ðŸ§ª Got Fuzz root: "+s),f=s,o.innerHTML=`Fuzz Root: ${s}`,a("Getting Fuzz targets: "),i({command:"getFuzzTargets",fuzzRoot:s});else{o.innerText="No Fuzz root found.";const l=document.createElement("button");l.textContent="Create a Root",l.addEventListener("click",()=>{i({command:"createFuzzRoot",target:r})}),o.appendChild(l)}t.results&&t.results.length>0&&(v=t.results,d(v,p))}});document.getElementById("start-analyzer").addEventListener("click",()=>{i({command:"runAnalyzer",target:"none",projectPath:r})});document.getElementById("test-vis").addEventListener("click",()=>{i({command:"testVisualization"})});
