const L=acquireVsCodeApi();let p=null;function h(t={}){p=t.onRustAnalysisDone||(()=>{}),onGlobalContext=t.onGlobalContext||(()=>{}),onFuzzTargetsListed=t.onFuzzTargetsListed||(()=>{}),window.addEventListener("message",o=>{const n=o.data;switch(n.command){case"globalContext":onGlobalContext&&onGlobalContext(n.context||{});break;case"rustAnalysisDone":s("Rust analysis completed successfully"),p&&p(n.results||[]);break;case"fuzzTargetsListed":onFuzzTargetsListed&&onFuzzTargetsListed(n.targets||[]);break;case"refreshHarnessList":onFuzzTargetsListed&&onFuzzTargetsListed(n.targets||[]);default:console.warn("Unhandled message from extension:",n);break}}),i({command:"getGlobaclContext"})}function i(t){L.postMessage(t)}function s(t){i({command:"log",message:t})}let u=null,z=null,y=null;const f=document.getElementById("entry-list"),C=document.getElementById("path-display-container");function g(t,o){var a;o.innerHTML="";const n=t.filter(e=>e.status!=="Ignore");t.filter(e=>e.status==="Ignore"),n.sort((e,c)=>c.priorityScore-e.priorityScore),t=[...n];for(const e of t){s(`status: ${e.status}`);const d=`<span class="status-badge" style="background:${{New:"gray",Ignore:"darkred",HarnessGenerated:"green"}[e.status]||"black"};">${e.status}</span>`,l=document.createElement("button");l.textContent="Ignore";const m=document.createElement("button");m.textContent="Generate Harness";const r=document.createElement("div");r.className="function-button",r.innerHTML=`
        <div style="font-weight:bold; margin-bottom:4px; display: flex; gap: 2px; flex-wrap: wrap; align-items: center;">
      <span>${e.functionModulePath}::${e.functionName}</span>
    ${d}
        </div>
        <div>${(a=e.functionLocation)==null?void 0:a.filePath.replace(u,"")}</div>
        <div>Priority Score: ${e.priorityScore.toFixed(3)}</div>
        <div class="btns-div" style="margin-top:6px;"></div>
      `;const b=r.getElementsByClassName("btns-div")[0];b.appendChild(l),b.appendChild(m),l.onclick=v=>{v.stopPropagation(),e.status="Ignore",s(`ignore, ${e.status}`),g(t,o)},m.onclick=v=>{s("generate"),i({command:"generateHarness",fuzzRoot:z,target:e}),e.status="HarnessGenerated",g(t,o)},r.onclick=()=>{i({command:"openLocation",filePath:e.functionLocation.filePath,offset:e.functionLocation.offset})},o.appendChild(r)}}function x(t){const o=t.nextElementSibling;t.classList.toggle("expanded")?o.style.display="block":o.style.display="none"}const E=document.querySelectorAll(".collapsible-header");E.forEach(t=>{s("Setting up collapsible header:",t.textContent),t.addEventListener("click",()=>{s("Collapsible header clicked:",t.textContent),x(t)})});h({onFuzzTargetsListed:t=>{s("ðŸ§ª Fuzz targets listed:");const o=document.getElementById("harness-list");if(o.innerHTML="",t.length===0){o.innerHTML="<div>No fuzz targets found.</div>";return}for(const n of t){const a=document.createElement("div"),e=document.createElement("button");e.textContent="Run";const c=document.createElement("button");c.textContent="Delete",a.className="function-button",a.innerHTML=`
        <div style="font-weight:bold; margin-bottom:4px;">
          ${n.name}
        </div>
        <div>
          ${n.path.replace(z,"")}
        </div>
          <div class="btns-div" style="margin-top:6px;"></div>
      `,a.onclick=()=>{i({command:"openLocation",filePath:n.path,offset:0})};const d=a.getElementsByClassName("btns-div")[0];d.appendChild(e),d.appendChild(c),c.onclick=l=>{l.stopPropagation(),s(`Deleting fuzz target: ${n.name}`),i({command:"deleteFuzzTarget",target:n.name})},e.onclick=l=>{l.stopPropagation(),s(`Running fuzz target: ${n.name}`),i({command:"runFuzzTarget",target:n.name})},o.appendChild(a)}},onRustAnalysisDone:t=>{s("Rendering function results"),f.innerHTML="",g(t,f)},onGlobalContext:t=>{s("Global context received:",t.projectRoot);const o=t.projectRoot;o?(s("ðŸ“¦ Got Cargo project root: "+o),u=o,C.innerHTML=`Cargo Project Root: ${o}`):C.innerHTML="No Cargo project found.";const n=document.getElementById("fuzz-path-display"),a=t.fuzzRoot;if(a)s("ðŸ§ª Got Fuzz root: "+a),z=a,n.innerHTML=`Fuzz Harness Root: ${a}`,s("Getting Fuzz targets: "),i({command:"getFuzzTargets",fuzzRoot:a});else{n.innerText="No Fuzz root found.";const e=document.createElement("button");e.textContent="Create a Root",e.addEventListener("click",()=>{i({command:"createFuzzRoot",target:u})}),n.appendChild(e)}t.results&&t.results.length>0&&(y=t.results,g(y,f))}});document.getElementById("start-analyzer").addEventListener("click",()=>{i({command:"runAnalyzer",target:"none",projectPath:u})});document.getElementById("test-vis").addEventListener("click",()=>{i({command:"testVisualization"})});
